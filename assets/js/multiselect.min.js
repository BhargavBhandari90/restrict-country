!function(c){var o={placeholder:"Select options",columns:1,search:!1,searchOptions:{default:"Search",showOptGroups:!1,onSearch:function(t){}},selectAll:!1,selectGroup:!1,minHeight:200,maxHeight:null,showCheckbox:!0,jqActualOpts:{},onLoad:function(t){c(t).hide()},onOptionClick:function(t,e){},maxWidth:null,minSelect:!1,maxSelect:!1},i=1;function s(t,e){this.element=t,this.options=c.extend({},o,e),this.load()}s.prototype={load:function(){var e=this;if("SELECT"!=e.element.nodeName||c(e.element).hasClass("jqmsLoaded"))return!0;c(e.element).addClass("jqmsLoaded"),c(e.element).after('<div class="ms-options-wrap"><button>None Selected</button><div class="ms-options"><ul></ul></div></div>');var t,o=c(e.element).next(".ms-options-wrap").find("> button:first-child"),i=c(e.element).next(".ms-options-wrap").find("> .ms-options"),s=i.find("> ul"),n=!!c(e.element).find("optgroup").length,l=null,a=("number"==typeof e.options.width?(i.parent().css("position","relative"),l=e.options.width):"string"==typeof e.options.width?(c(e.options.width).css("position","relative"),l="100%"):i.parent().css("position","relative"),c(window).height()-i.offset().top-20),a=(a=e.options.maxHeight?(a=c(window).height()-i.offset().top-20)<e.options.minHeight?e.options.minHeight:maxheight:a)<e.options.minHeight?e.options.minHeight:a,p=(i.css({maxWidth:l,minHeight:e.options.minHeight,maxHeight:a,overflow:"auto"}).hide(),i.bind("touchmove mousewheel DOMMouseScroll",function(t){var e;c(this).outerHeight()<c(this)[0].scrollHeight&&(e=(e=t.originalEvent).wheelDelta||-e.detail,c(this).outerHeight()+c(this)[0].scrollTop>c(this)[0].scrollHeight&&(t.preventDefault(),this.scrollTop+=e<0?1:-1))}),c(document).off("click.ms-hideopts").on("click.ms-hideopts",function(t){c(t.target).closest(".ms-options-wrap").length||c(".ms-options-wrap > .ms-options:visible").hide()}),o.bind("mousedown",function(t){if(1!=t.which)return!0;c(".ms-options-wrap > .ms-options:visible").each(function(){c(this).parent().prev()[0]!=i.parent().prev()[0]&&c(this).hide()}),i.toggle(),i.is(":visible")&&(i.css("maxHeight",""),t=c(window).height()-i.offset().top-20,t=(t=e.options.maxHeight?(t=c(window).height()-i.offset().top-20)<e.options.minHeight?e.options.minHeight:maxheight:t)<e.options.minHeight?e.options.minHeight:t,i.css("maxHeight",t))}).click(function(t){t.preventDefault()}),e.options.placeholder&&o.text(e.options.placeholder),e.options.search&&(s.before('<div class="ms-search"><input type="text" value="" placeholder="'+e.options.searchOptions.default+'" /></div>'),(t=i.find(".ms-search input")).on("keyup",function(){if(c(this).data("lastsearch")==c(this).val())return!0;c(this).data("lastsearch",c(this).val()),"function"==typeof e.options.searchOptions.onSearch&&e.options.searchOptions.onSearch(e.element),s.find("li:not(.optgroup)").each(function(){-1<c(this).text().toLowerCase().indexOf(t.val().toLowerCase())?c(this).show():c(this).hasClass("selected")||c(this).hide(),!e.options.searchOptions.showOptGroups&&c(this).closest("li.optgroup")&&(c(this).closest("li.optgroup").show(),c(this).closest("li.optgroup").find("li:visible").length?c(this).closest("li.optgroup").show():c(this).closest("li.optgroup").hide())})})),e.options.selectAll&&s.before('<a href="#" class="ms-selectall global">Select all</a>'),i.on("click",".ms-selectall",function(t){t.preventDefault(),c(this).hasClass("global")?(s.find("li:not(.optgroup)").filter(":not(.selected)").length?s.find("li:not(.optgroup)").filter(":not(.selected)").find('input[type="checkbox"]'):s.find('li:not(.optgroup).selected input[type="checkbox"]')).trigger("click"):c(this).closest("li").hasClass("optgroup")&&((t=c(this).closest("li.optgroup")).find("li:not(.selected)").length?t.find('li:not(.selected) input[type="checkbox"]'):t.find('li.selected input[type="checkbox"]')).trigger("click")}),[]);c(e.element).children().each(function(){if("OPTGROUP"==this.nodeName){var t=[];c(this).children("option").each(function(){t[c(this).val()]={name:c(this).text(),value:c(this).val(),checked:c(this).prop("selected")}}),p.push({label:c(this).attr("label"),options:t})}else{if("OPTION"!=this.nodeName)return!0;p.push({name:c(this).text(),value:c(this).val(),checked:c(this).prop("selected")})}}),e.loadOptions(p),n?(s.find("> li:not(.optgroup)").css({float:"left",width:100/e.options.columns+"%"}),s.find("li.optgroup").css({clear:"both"}).find("> ul").css({"column-count":e.options.columns,"column-gap":0,"-webkit-column-count":e.options.columns,"-webkit-column-gap":0,"-moz-column-count":e.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&s.find("li.optgroup > ul > li").css({float:"left",width:100/e.options.columns+"%"})):(s.css({"column-count":e.options.columns,"column-gap":0,"-webkit-column-count":e.options.columns,"-webkit-column-gap":0,"-moz-column-count":e.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&s.find("> li").css({float:"left",width:100/e.options.columns+"%"})),i.on("click",'input[type="checkbox"]',function(){c(this).closest("li").toggleClass("selected"),i.parent().prev().find('option[value="'+c(this).val()+'"]').prop("selected",c(this).is(":checked")).closest("select").trigger("change"),"function"==typeof e.options.onOptionClick&&e.options.onOptionClick(),e._updatePlaceholderText()}),"function"==typeof e.options.onLoad?e.options.onLoad(e.element):c(e.element).hide()},loadOptions:function(t,e){e="boolean"!=typeof e||e;var o,i=c(this.element).next(".ms-options-wrap").find("> .ms-options > ul");for(o in e&&i.find("> li").remove(),t){var s=t[o],n=c("<li></li>");if(s.hasOwnProperty("options"))for(var l in n.addClass("optgroup"),n.append('<span class="label">'+s.label+"</span>"),n.find("> .label").css({clear:"both"}),this.options.selectGroup&&n.append('<a href="#" class="ms-selectall">Select all</a>'),n.append("<ul></ul>"),s.options){var l=s.options[l],a=c("<li></li>").addClass("ms-reflow");this._addOption(a,l),n.find("> ul").append(a)}else s.hasOwnProperty("value")&&(n.addClass("ms-reflow"),this._addOption(n,s));i.append(n)}i.find('.ms-reflow input[type="checkbox"]').each(function(t){var e;c(this).css("display").match(/block$/)&&(e=(e=c(this).outerWidth())||15,c(this).closest("label").css("padding-left",2*parseInt(c(this).closest("label").css("padding-left"))+e),c(this).closest(".ms-reflow").removeClass("ms-reflow"))}),this._updatePlaceholderText()},unload:function(){c(this.element).next(".ms-options-wrap").remove(),c(this.element).show(function(){c(this).css("display","").removeClass("jqmsLoaded")})},reload:function(){c(this.element).next(".ms-options-wrap").remove(),c(this.element).removeClass("jqmsLoaded"),this.load()},_updatePlaceholderText:function(){var t=c(this.element).next(".ms-options-wrap").find("> button:first-child"),e=c(this.element).next(".ms-options-wrap").find("> .ms-options"),o=e.parent().prev(),i=[],o=(o.find("option:selected").each(function(){i.push(c(this).text())}),t.text(i.join(", ")),t.clone().css({display:"inline",width:"auto",visibility:"hidden"}).appendTo(e.parent()));(void 0!==c.fn.actual?o.actual("width",this.options.jqActualOpts):o.width())>(void 0!==c.fn.actual?t.actual("width",this.options.jqActualOpts):t.width())?t.text(i.length+" selected"):i.length?t.text(i.join(", ")):t.text(this.options.placeholder),o.remove()},_addOption:function(t,e){t.text(e.name),t.prepend(c('<input type="checkbox" value="" title="" />').val(e.value).attr("title",e.name).attr("id","ms-opt-"+i)),e.checked&&(t.addClass("default"),t.addClass("selected"),t.find('input[type="checkbox"]').prop("checked",!0));e=c("<label></label>").attr("for","ms-opt-"+i);t.wrapInner(e),this.options.showCheckbox||t.find('input[id="ms-opt-'+i+'"]').hide(),i+=1},_ieVersion:function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("msie")&&parseInt(t.split("msie")[1])}},c.fn.multiselect=function(e){var o,i=arguments;return void 0===e||"object"==typeof e?this.each(function(){c.data(this,"plugin_multiselect")||c.data(this,"plugin_multiselect",new s(this,e))}):"string"==typeof e&&"_"!==e[0]&&"init"!==e?(this.each(function(){var t=c.data(this,"plugin_multiselect");t instanceof s&&"function"==typeof t[e]&&(o=t[e].apply(t,Array.prototype.slice.call(i,1))),"unload"===e&&c.data(this,"plugin_multiselect",null)}),o):void 0}}(jQuery);